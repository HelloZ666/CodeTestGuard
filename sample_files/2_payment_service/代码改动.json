{
  "success": true,
  "data": {
    "current": [
      "package com.example.payment;\n\nimport java.math.BigDecimal;\nimport java.util.Date;\nimport java.util.UUID;\n\npublic class PaymentService {\n\n    private PaymentRepository paymentRepository;\n    private OrderService orderService;\n    private NotificationService notificationService;\n    private PaymentGateway paymentGateway;\n\n    public Payment processPayment(Long orderId, BigDecimal amount, String paymentMethod) {\n        if (amount == null || amount.compareTo(BigDecimal.ZERO) <= 0) {\n            throw new IllegalArgumentException(\"Amount must be greater than zero\");\n        }\n        if (paymentMethod == null || paymentMethod.isEmpty()) {\n            throw new IllegalArgumentException(\"Payment method is required\");\n        }\n\n        Order order = orderService.getOrderById(orderId);\n        if (order.getStatus().equals(\"paid\")) {\n            throw new IllegalStateException(\"Order already paid\");\n        }\n\n        Payment payment = new Payment();\n        payment.setOrderId(orderId);\n        payment.setAmount(amount);\n        payment.setPaymentMethod(paymentMethod);\n        payment.setStatus(\"pending\");\n        payment.setPaymentNo(\"PAY\" + UUID.randomUUID().toString().substring(0, 8).toUpperCase());\n        payment.setCreatedAt(new Date());\n\n        Payment result = paymentGateway.process(payment);\n        if (result.getStatus().equals(\"success\")) {\n            payment.setStatus(\"success\");\n            payment.setPaidAt(new Date());\n            orderService.updateOrderStatus(orderId, \"paid\");\n            notificationService.notifyPaymentSuccess(orderId);\n        } else {\n            payment.setStatus(\"failed\");\n            payment.setErrorMessage(result.getErrorMessage());\n        }\n\n        return paymentRepository.save(payment);\n    }\n\n    public Refund refundPayment(Long paymentId, String reason) {\n        Payment payment = paymentRepository.findById(paymentId);\n        if (payment == null) {\n            throw new RuntimeException(\"Payment not found\");\n        }\n        if (!\"success\".equals(payment.getStatus())) {\n            throw new IllegalStateException(\"Can only refund successful payments\");\n        }\n        if (payment.getRefundedAt() != null) {\n            throw new IllegalStateException(\"Payment already refunded\");\n        }\n\n        Refund refund = new Refund();\n        refund.setPaymentId(paymentId);\n        refund.setAmount(payment.getAmount());\n        refund.setReason(reason);\n        refund.setStatus(\"processing\");\n        refund.setRefundNo(\"REF\" + UUID.randomUUID().toString().substring(0, 8).toUpperCase());\n\n        Refund result = paymentGateway.refund(refund);\n        if (result.getStatus().equals(\"success\")) {\n            refund.setStatus(\"success\");\n            refund.setRefundedAt(new Date());\n            orderService.updateOrderStatus(payment.getOrderId(), \"refunded\");\n        }\n\n        return paymentRepository.saveRefund(refund);\n    }\n\n    public String getPaymentStatus(Long paymentId) {\n        Payment payment = paymentRepository.findById(paymentId);\n        if (payment == null) {\n            throw new RuntimeException(\"Payment not found\");\n        }\n        return payment.getStatus();\n    }\n\n    public void cancelPayment(Long paymentId) {\n        Payment payment = paymentRepository.findById(paymentId);\n        if (payment == null) {\n            throw new RuntimeException(\"Payment not found\");\n        }\n        if (!\"pending\".equals(payment.getStatus())) {\n            throw new IllegalStateException(\"Can only cancel pending payments\");\n        }\n        payment.setStatus(\"cancelled\");\n        paymentRepository.save(payment);\n    }\n\n    public boolean verifyPayment(Long paymentId, String signature) {\n        Payment payment = paymentRepository.findById(paymentId);\n        if (payment == null) {\n            return false;\n        }\n        String expectedSignature = paymentGateway.generateSignature(payment);\n        return expectedSignature.equals(signature);\n    }\n\n    public String createPaymentLink(Long orderId, BigDecimal amount) {\n        Order order = orderService.getOrderById(orderId);\n        String paymentNo = \"PAY\" + UUID.randomUUID().toString().substring(0, 8).toUpperCase();\n        return paymentGateway.createPaymentLink(orderId, amount, paymentNo);\n    }\n\n    public void notifyPaymentSuccess(Long orderId) {\n        notificationService.sendNotification(orderId, \"payment_success\");\n    }\n}"
    ],
    "history": [
      "package com.example.payment;\n\nimport java.math.BigDecimal;\n\npublic class PaymentService {\n\n    private PaymentRepository paymentRepository;\n\n    public Payment processPayment(Long orderId, BigDecimal amount) {\n        Payment payment = new Payment();\n        payment.setOrderId(orderId);\n        payment.setAmount(amount);\n        payment.setStatus(\"pending\");\n        return paymentRepository.save(payment);\n    }\n\n    public String getPaymentStatus(Long paymentId) {\n        Payment payment = paymentRepository.findById(paymentId);\n        return payment != null ? payment.getStatus() : null;\n    }\n\n    public void cancelPayment(Long paymentId) {\n        Payment payment = paymentRepository.findById(paymentId);\n        payment.setStatus(\"cancelled\");\n        paymentRepository.save(payment);\n    }\n}"
    ]
  }
}
