{
  "success": true,
  "data": {
    "current": [
      "package com.example.product;\n\nimport java.math.BigDecimal;\nimport java.util.List;\nimport java.util.Date;\n\npublic class ProductService {\n\n    private ProductRepository productRepository;\n    private ReviewRepository reviewRepository;\n    private SearchService searchService;\n\n    public Product createProduct(String name, BigDecimal price, Integer stock, String description) {\n        if (name == null || name.isEmpty()) {\n            throw new IllegalArgumentException(\"Product name cannot be empty\");\n        }\n        if (price == null || price.compareTo(BigDecimal.ZERO) < 0) {\n            throw new IllegalArgumentException(\"Price cannot be negative\");\n        }\n        if (stock == null || stock < 0) {\n            throw new IllegalArgumentException(\"Stock cannot be negative\");\n        }\n\n        Product product = new Product();\n        product.setName(name);\n        product.setPrice(price);\n        product.setStock(stock);\n        product.setDescription(description);\n        product.setStatus(stock > 0 ? \"active\" : \"out_of_stock\");\n        product.setCreatedAt(new Date());\n\n        Product saved = productRepository.save(product);\n        searchService.indexProduct(saved);\n        return saved;\n    }\n\n    public Product updateProduct(Long id, String name, BigDecimal price, String description) {\n        Product product = productRepository.findById(id);\n        if (product == null) {\n            throw new RuntimeException(\"Product not found\");\n        }\n        if (name != null && !name.isEmpty()) {\n            product.setName(name);\n        }\n        if (price != null) {\n            product.setPrice(price);\n        }\n        if (description != null) {\n            product.setDescription(description);\n        }\n        product.setUpdatedAt(new Date());\n\n        Product updated = productRepository.save(product);\n        searchService.updateProduct(updated);\n        return updated;\n    }\n\n    public void deleteProduct(Long id) {\n        Product product = productRepository.findById(id);\n        if (product == null) {\n            throw new RuntimeException(\"Product not found\");\n        }\n        product.setStatus(\"deleted\");\n        product.setDeletedAt(new Date());\n        productRepository.save(product);\n        searchService.deleteProduct(id);\n    }\n\n    public Product getProductById(Long id) {\n        Product product = productRepository.findById(id);\n        if (product == null || \"deleted\".equals(product.getStatus())) {\n            throw new RuntimeException(\"Product not found\");\n        }\n        return product;\n    }\n\n    public List<Product> listProducts(int page, int size, String category) {\n        if (page < 0 || size <= 0) {\n            throw new IllegalArgumentException(\"Invalid pagination parameters\");\n        }\n        return productRepository.findByCategory(category, page, size);\n    }\n\n    public void updateStock(Long id, int quantity, boolean isIncrease) {\n        Product product = productRepository.findById(id);\n        if (product == null) {\n            throw new RuntimeException(\"Product not found\");\n        }\n\n        int newStock;\n        if (isIncrease) {\n            newStock = product.getStock() + quantity;\n        } else {\n            newStock = product.getStock() - quantity;\n            if (newStock < 0) {\n                throw new RuntimeException(\"Insufficient stock\");\n            }\n        }\n\n        product.setStock(newStock);\n        product.setStatus(newStock > 0 ? \"active\" : \"out_of_stock\");\n        product.setUpdatedAt(new Date());\n        productRepository.save(product);\n    }\n\n    public List<Product> searchProducts(String keyword, int page, int size) {\n        return searchService.search(keyword, page, size);\n    }\n\n    public ProductDetail getProductDetail(Long id) {\n        Product product = getProductById(id);\n        List<Review> reviews = reviewRepository.findByProductId(id);\n        double avgRating = reviews.stream()\n            .mapToInt(Review::getRating)\n            .average()\n            .orElse(0.0);\n\n        ProductDetail detail = new ProductDetail();\n        detail.setProduct(product);\n        detail.setReviews(reviews);\n        detail.setAverageRating(avgRating);\n        return detail;\n    }\n}"
    ],
    "history": [
      "package com.example.product;\n\nimport java.math.BigDecimal;\n\npublic class ProductService {\n\n    private ProductRepository productRepository;\n\n    public Product createProduct(String name, BigDecimal price) {\n        Product product = new Product();\n        product.setName(name);\n        product.setPrice(price);\n        return productRepository.save(product);\n    }\n\n    public Product updateProduct(Long id, String name, BigDecimal price) {\n        Product product = productRepository.findById(id);\n        product.setName(name);\n        product.setPrice(price);\n        return productRepository.save(product);\n    }\n\n    public Product getProductById(Long id) {\n        return productRepository.findById(id);\n    }\n\n    public List<Product> listProducts(int page, int size) {\n        return productRepository.findAll(page, size);\n    }\n}"
    ]
  }
}
