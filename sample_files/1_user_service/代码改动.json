{
  "success": true,
  "data": {
    "current": [
      "package com.example.user;\n\nimport java.util.List;\nimport java.util.Date;\nimport java.util.UUID;\n\npublic class UserService {\n\n    private UserRepository userRepository;\n    private EmailService emailService;\n    private PasswordEncoder passwordEncoder;\n\n    public User createUser(String name, String email) {\n        if (name == null || name.isEmpty()) {\n            throw new IllegalArgumentException(\"Name cannot be empty\");\n        }\n        if (email == null || !email.contains(\"@\")) {\n            throw new IllegalArgumentException(\"Invalid email format\");\n        }\n        User user = new User(name, email);\n        user.setStatus(\"active\");\n        user.setCreatedAt(new Date());\n        User saved = userRepository.save(user);\n        emailService.sendWelcomeEmail(saved.getEmail());\n        return saved;\n    }\n\n    public User updateUser(Long id, String name, String email) {\n        User user = userRepository.findById(id);\n        if (user == null) {\n            throw new RuntimeException(\"User not found\");\n        }\n        if (\"deleted\".equals(user.getStatus())) {\n            throw new RuntimeException(\"Cannot update deleted user\");\n        }\n        user.setName(name);\n        user.setEmail(email);\n        user.setUpdatedAt(new Date());\n        return userRepository.save(user);\n    }\n\n    public void deleteUser(Long id) {\n        User user = userRepository.findById(id);\n        if (user == null) {\n            throw new RuntimeException(\"User not found\");\n        }\n        user.setStatus(\"deleted\");\n        user.setDeletedAt(new Date());\n        userRepository.save(user);\n    }\n\n    public List<User> listUsers(int page, int size) {\n        if (page < 0 || size <= 0) {\n            throw new IllegalArgumentException(\"Invalid pagination parameters\");\n        }\n        return userRepository.findAll(page, size);\n    }\n\n    public User getUserById(Long id) {\n        User user = userRepository.findById(id);\n        if (user == null) {\n            throw new RuntimeException(\"User not found\");\n        }\n        return user;\n    }\n\n    public void changePassword(Long id, String oldPassword, String newPassword) {\n        User user = userRepository.findById(id);\n        if (user == null) {\n            throw new RuntimeException(\"User not found\");\n        }\n        if (!passwordEncoder.matches(oldPassword, user.getPassword())) {\n            throw new IllegalArgumentException(\"Incorrect old password\");\n        }\n        user.setPassword(passwordEncoder.encode(newPassword));\n        userRepository.save(user);\n    }\n\n    public void resetPassword(String email) {\n        User user = userRepository.findByEmail(email);\n        if (user == null) {\n            throw new RuntimeException(\"User not found\");\n        }\n        String token = UUID.randomUUID().toString();\n        user.setResetToken(token);\n        userRepository.save(user);\n        emailService.sendPasswordResetEmail(email, token);\n    }\n\n    public boolean validateEmail(Long id) {\n        User user = userRepository.findById(id);\n        return user != null && user.isEmailVerified();\n    }\n}"
    ],
    "history": [
      "package com.example.user;\n\nimport java.util.List;\n\npublic class UserService {\n\n    private UserRepository userRepository;\n\n    public User createUser(String name, String email) {\n        User user = new User(name, email);\n        return userRepository.save(user);\n    }\n\n    public User updateUser(Long id, String name, String email) {\n        User user = userRepository.findById(id);\n        user.setName(name);\n        user.setEmail(email);\n        return userRepository.save(user);\n    }\n\n    public List<User> listUsers(int page, int size) {\n        return userRepository.findAll(page, size);\n    }\n\n    public User getUserById(Long id) {\n        return userRepository.findById(id);\n    }\n}"
    ]
  }
}
