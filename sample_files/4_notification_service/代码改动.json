{
  "success": true,
  "data": {
    "current": [
      "package com.example.notification;\n\nimport java.util.List;\nimport java.util.Date;\nimport java.util.Random;\nimport java.util.stream.Collectors;\n\npublic class NotificationService {\n\n    private EmailProvider emailProvider;\n    private SMSProvider smsProvider;\n    private PushProvider pushProvider;\n    private NotificationRepository notificationRepository;\n    private ScheduledTaskRepository taskRepository;\n\n    public String sendEmail(String to, String subject, String content) {\n        if (to == null || !to.matches(\"^[A-Za-z0-9+_.-]+@(.+)$\")) {\n            throw new IllegalArgumentException(\"Invalid email address\");\n        }\n        if (subject == null || subject.isEmpty()) {\n            throw new IllegalArgumentException(\"Subject cannot be empty\");\n        }\n        if (content == null || content.isEmpty()) {\n            throw new IllegalArgumentException(\"Content cannot be empty\");\n        }\n\n        Notification notification = new Notification();\n        notification.setType(\"email\");\n        notification.setTo(to);\n        notification.setSubject(subject);\n        notification.setContent(content);\n        notification.setStatus(\"sending\");\n        notification.setCreatedAt(new Date());\n\n        try {\n            emailProvider.send(to, subject, content);\n            notification.setStatus(\"sent\");\n            notification.setSentAt(new Date());\n        } catch (Exception e) {\n            notification.setStatus(\"failed\");\n            notification.setErrorMessage(e.getMessage());\n        }\n\n        return notificationRepository.save(notification).getId();\n    }\n\n    public String sendSMS(String phoneNumber, String content) {\n        if (phoneNumber == null || !phoneNumber.matches(\"^1[3-9]\\\\d{9}$\")) {\n            throw new IllegalArgumentException(\"Invalid phone number format\");\n        }\n        if (content == null || content.isEmpty()) {\n            throw new IllegalArgumentException(\"Content cannot be empty\");\n        }\n        if (content.length() > 500) {\n            throw new IllegalArgumentException(\"SMS content too long\");\n        }\n\n        Notification notification = new Notification();\n        notification.setType(\"sms\");\n        notification.setTo(phoneNumber);\n        notification.setContent(content);\n        notification.setStatus(\"sending\");\n\n        try {\n            smsProvider.send(phoneNumber, content);\n            notification.setStatus(\"sent\");\n            notification.setSentAt(new Date());\n        } catch (Exception e) {\n            notification.setStatus(\"failed\");\n        }\n\n        return notificationRepository.save(notification).getId();\n    }\n\n    public String sendPush(Long userId, String title, String content) {\n        if (userId == null) {\n            throw new IllegalArgumentException(\"User ID cannot be null\");\n        }\n        if (content == null || content.isEmpty()) {\n            throw new IllegalArgumentException(\"Content cannot be empty\");\n        }\n\n        Notification notification = new Notification();\n        notification.setType(\"push\");\n        notification.setUserId(userId);\n        notification.setTitle(title);\n        notification.setContent(content);\n        notification.setStatus(\"sending\");\n\n        try {\n            pushProvider.send(userId, title, content);\n            notification.setStatus(\"sent\");\n            notification.setSentAt(new Date());\n        } catch (Exception e) {\n            notification.setStatus(\"failed\");\n        }\n\n        return notificationRepository.save(notification).getId();\n    }\n\n    public BatchSendResult batchSend(List<String> recipients, String type, String subject, String content) {\n        List<String> successList = recipients.stream()\n            .filter(r -> {\n                try {\n                    if (\"email\".equals(type)) {\n                        sendEmail(r, subject, content);\n                    } else if (\"sms\".equals(type)) {\n                        sendSMS(r, content);\n                    }\n                    return true;\n                } catch (Exception e) {\n                    return false;\n                }\n            })\n            .collect(Collectors.toList());\n\n        List<String> failedList = recipients.stream()\n            .filter(r -> !successList.contains(r))\n            .collect(Collectors.toList());\n\n        BatchSendResult result = new BatchSendResult();\n        result.setSuccessCount(successList.size());\n        result.setFailedCount(failedList.size());\n        result.setFailedRecipients(failedList);\n        return result;\n    }\n\n    public String getNotificationStatus(String notificationId) {\n        Notification notification = notificationRepository.findById(notificationId);\n        if (notification == null) {\n            throw new RuntimeException(\"Notification not found\");\n        }\n        return notification.getStatus();\n    }\n\n    public String sendVerificationCode(String phoneNumber) {\n        String code = String.format(\"%06d\", new Random().nextInt(1000000));\n        String content = \"Your verification code is: \" + code + \", valid for 5 minutes.\";\n\n        String notificationId = sendSMS(phoneNumber, content);\n\n        VerificationCode verificationCode = new VerificationCode();\n        verificationCode.setPhoneNumber(phoneNumber);\n        verificationCode.setCode(code);\n        verificationCode.setExpiredAt(new Date(System.currentTimeMillis() + 5 * 60 * 1000));\n        verificationCode.setNotificationId(notificationId);\n\n        return notificationRepository.saveVerificationCode(verificationCode).getId();\n    }\n\n    public String scheduleNotification(String type, String recipient, String content, Date scheduledTime) {\n        if (scheduledTime == null) {\n            throw new IllegalArgumentException(\"Scheduled time cannot be null\");\n        }\n        if (scheduledTime.before(new Date())) {\n            throw new IllegalArgumentException(\"Scheduled time must be in the future\");\n        }\n\n        ScheduledTask task = new ScheduledTask();\n        task.setType(type);\n        task.setRecipient(recipient);\n        task.setContent(content);\n        task.setScheduledTime(scheduledTime);\n        task.setStatus(\"pending\");\n        task.setCreatedAt(new Date());\n\n        return taskRepository.save(task).getId();\n    }\n}"
    ],
    "history": [
      "package com.example.notification;\n\npublic class NotificationService {\n\n    private EmailProvider emailProvider;\n    private SMSProvider smsProvider;\n\n    public String sendEmail(String to, String subject, String content) {\n        return emailProvider.send(to, subject, content);\n    }\n\n    public String sendSMS(String phoneNumber, String content) {\n        return smsProvider.send(phoneNumber, content);\n    }\n\n    public String getNotificationStatus(String notificationId) {\n        return \"sent\";\n    }\n}"
    ]
  }
}
